/**
 @license
 Sideshow - An incredible Javascript interactive help Library
 Version: 0.4.1
 Date: 2014-11-27
 Author: Alcides Queiroz [alcidesqueiroz(at)gmail(dot)com]
 Available under Apache License 2.0 (https://raw2.github.com/fortesinformatica/sideshow/master/LICENSE)
 **/

!function(t,e,i,s){!function(e,i){var s=i();"function"==typeof define&&define.amd?define(i):t[e]=s}("sideshow",function(){function n(t,e){this.name="SSException",this.message="[SIDESHOW_E#"+("00000000"+t).substr(-8)+"] "+e}function o(t,e){console.warn("[SIDESHOW_W#"+("00000000"+t).substr(-8)+"] "+e)}function r(t){if(t.constructor!==String)return t;var e=""===t?"0":t;return+e.replace("px","")}function a(t){return C.config.language in t?t[C.config.language]:(o("2001","String not found for the selected language, getting the first available."),t[Object.keys(t)[0]])}function h(){g.keyup(l)}function d(){g.unbind("keyup",l)}function l(t){(27==t.keyCode||112==t.keyCode)&&C.close()}function u(){g.keyup(function(t){113==t.keyCode&&(t.shiftKey?C.start({listAll:!0}):C.start())})}function c(){e('[class*="sideshow"]').not(".sideshow-mask-part, .sideshow-mask-corner-part, .sideshow-subject-mask").remove()}if(void 0===e)throw new n("2","jQuery is required for Sideshow to work.");if(void 0===i)throw new n("3","Jazz is required for Sideshow to work.");if(void 0===s)throw new n("4","Pagedown (the Markdown parser used by Sideshow) is required for Sideshow to work.");var f,p,g,m,w="Sideshow",b=150,v=600,C={get VERSION(){return"0.4.1"}},S=[],x={lockMaskUpdate:!1,changingStep:!1,skippingStep:!1,running:!1},k=[],I=i.Enum("VISIBLE","FADING_IN","FADING_OUT","NOT_DISPLAYED","NOT_RENDERED","TRANSPARENT");n.prototype=new Error,n.prototype.constructor=n;var y={availableWizards:{en:"Available Tutorials","pt-br":"Tutoriais Disponíveis",es:"Tutoriales Disponibles"},relatedWizards:{en:"Related Wizards","pt-br":"Tutoriais Relacionados",es:"Tutoriales Relacionados"},noAvailableWizards:{en:"There's no tutorials available.","pt-br":"Não há tutoriais disponíveis para esta tela.",es:"No hay tutoriales disponibles."},close:{en:"Close","pt-br":"Fechar",es:"Cerrar"},estimatedTime:{en:"Estimated Time","pt-br":"Tempo Estimado",es:"Tiempo Estimado"},next:{en:"Next","pt-br":"Continuar",es:"Continuar"},finishWizard:{en:"Finish Wizard","pt-br":"Concluir Tutorial",es:"Concluir Tutorial"}};C.config={},C.config.userPreferencesRoute=null,C.config.loggedInUser=null,C.config.language="en",C.config.autoSkipIntro=!1,C.ControlVariables={},C.ControlVariables.set=function(t,e){var i={};return this.isDefined(t)?i=this.getNameValuePair(t):S.push(i),i.name=t,i.value=e,t+"="+e},C.ControlVariables.setIfUndefined=function(t,e){return this.isDefined(t)?void 0:this.set(t,e)},C.ControlVariables.isDefined=function(t){return void 0!==this.getNameValuePair(t)},C.ControlVariables.get=function(t){var e=this.getNameValuePair(t);return e?e.value:void 0},C.ControlVariables.getNameValuePair=function(t){for(var e=0;e<S.length;e++){var i=S[e];if(i.name===t)return i}},C.ControlVariables.remove=function(t){return S.splice(S.indexOf(this.getNameValuePair(t)),1)},C.ControlVariables.clear=function(){S=[]};var T=i.Class().abstract;T.field("$el"),T.field("status",I.NOT_RENDERED),T.method("render",function(t){(t||p).append(this.$el),this.status=I.NOT_DISPLAYED}),T.method("destroy",function(){this.$el.remove()});var $=i.Class().extending(T).abstract;$.method("show",function(t){this.$el||this.render(),t||this.$el.removeClass("sideshow-invisible"),this.$el.removeClass("sideshow-hidden"),this.status=I.VISIBLE}),$.method("hide",function(t){t||this.$el.addClass("sideshow-hidden"),this.$el.addClass("sideshow-invisible"),this.status=I.NOT_DISPLAYED});var j=i.Class().extending($).abstract;j.method("fadeIn",function(t,e){var i=this;i.status=I.FADING_IN,i.$el||this.render(),e&&i.$el.css("animation-timing-function","linear"),i.$el.removeClass("sideshow-hidden"),setTimeout(function(){i.$el.removeClass("sideshow-invisible"),setTimeout(function(){i.status=I.VISIBLE,e&&i.$el.css("animation-timing-function","ease"),t&&t()},v)},20)}),j.method("fadeOut",function(t,e){var i=this;i.status!=I.NOT_RENDERED&&(i.status=I.FADING_OUT,e&&i.$el.css("animation-timing-function","linear"),i.$el.addClass("sideshow-invisible"),setTimeout(function(){i.$el.addClass("sideshow-hidden"),i.status=I.NOT_DISPLAYED,e&&i.$el.css("animation-timing-function","ease"),t&&t()},v))});var M=i.Class(function(t){this.name=t.name,this.title=t.title,this.description=t.description,this.estimatedTime=t.estimatedTime,this.affects=t.affects,this.preparation=t.preparation,this.listeners=t.listeners,this.showStepPosition=t.showStepPosition,this.relatedWizards=t.relatedWizards});M.field("preparation"),M.field("listeners"),M.field("showStepPosition"),M.field("relatedWizards"),M.field("name"),M.field("title"),M.field("description"),M.field("estimatedTime"),M.field("affects"),M.field("_storyline"),M.field("currentStep"),M.method("storyLine",function(t){this._storyline=t}),M.method("play",function(){var t=this;if(A.enqueue("check_composite_mask_subject_changes",function(){N.CompositeMask.singleInstance.pollForSubjectChanges()}),A.enqueue("check_arrow_changes",function(){P.pollForArrowsChanges(!0)}),!this._storyline)throw new n("201","A wizard needs to have a storyline.");var e=this._storyline.steps;if(0===e.length)throw new n("202","A storyline must have at least one step.");E.singleInstance.render(),z.singleInstance.render();var i=this.listeners;i&&i.beforeWizardStarts&&i.beforeWizardStarts(),x.changingStep=!0,this.showStep(e[0],function(){A.enqueue("check_completed_step",function(){t.pollForCheckCompletedStep()})}),N.CompositeMask.singleInstance.fadeIn()}),M.method("showStep",function(t,e){function i(){x.skippingStep=!0,n.next()}var n=this;if(x.skippingStep=!1,P.clear(),this.currentStep&&this.currentStep.listeners&&this.currentStep.listeners.afterStep&&this.currentStep.listeners.afterStep(),t&&t.listeners&&t.listeners.beforeStep&&t.listeners.beforeStep(),this.currentStep=t,t.skipIf&&t.skipIf()&&i(this),x.changingStep&&!x.skippingStep){t.subject?C.setSubject(t.subject):C.setEmptySubject(),N.CompositeMask.singleInstance.update(W.position,W.dimension,W.borderRadius);var o=N.SubjectMask.singleInstance;o.fadeOut(function(){t.lockSubject&&o.show(!0)}),E.singleInstance.show(),E.singleInstance.positionate();var r=z.singleInstance,h=t.text;if(h=h instanceof Function?C.heredoc(h):h,"markdown"==t.format?r.setHTML((new s.Converter).makeHtml(h)):r.setText(h),r.setTitle(t.title),r.setStepPosition(this.getStepPosition()+1+"/"+this._storyline.steps.length),t.showNextButton||t.autoContinue===!1||!(t.completingConditions&&t.completingConditions.length>0)){var d=this._storyline.steps[this.getStepPosition()+1];r.nextButton.setText(d?a(y.next)+": "+this._storyline.steps[this.getStepPosition()+1].title:a(y.finishWizard)),r.nextButton.show(),t.autoContinue===!1&&r.nextButton.disable()}else r.nextButton.hide();t.targets&&t.targets.length>0&&(P.setTargets(t.targets),P.render(),P.positionate(),P.fadeIn()),r.show(!0),N.CompositeMask.singleInstance.scrollIfNecessary(W.position,W.dimension)||(r.positionate(),r.fadeIn()),e&&e(),x.changingStep=!1}}),M.method("next",function(t,e){if(!x.changingStep||x.skippingStep){x.changingStep=!0;var i=this.currentStep;e=e||this._storyline.steps[this.getStepPosition(this.currentStep)+1];var s=this;this.hideStep(function(){if(e)s.showStep(e,function(){t&&t()});else{i&&i.listeners&&i.listeners.afterStep&&i.listeners.afterStep();var n=m;m=null;var o=s.listeners;o&&o.afterWizardEnds&&o.afterWizardEnds(),C.showRelatedWizardsList(n)||C.close()}})}}),M.method("hideStep",function(t){z.singleInstance.fadeOut(function(){E.singleInstance.hide()}),P.fadeOut(),N.SubjectMask.singleInstance.update(W.position,W.dimension,W.borderRadius),N.SubjectMask.singleInstance.fadeIn(t)}),M.method("getStepPosition",function(t){return this._storyline.steps.indexOf(t||this.currentStep)}),M.method("isEligible",function(){function e(t,e,i){return i?t===e:t.toLowerCase()===e.toLowerCase()}for(var i=t.location,s=0;s<this.affects.length;s++){var n=this.affects[s];if(n instanceof Function){if(n())return!0}else if(n instanceof Object){if("route"in n){var o=i.pathname+i.search+i.hash;if(e(o,n.route,n.caseSensitive))return!0}if("hash"in n&&e(location.hash,n.hash,n.caseSensitive))return!0;if("url"in n&&e(location.href,n.url,n.caseSensitive))return!0}}return!1}),M.method("isAlreadyWatched",function(){return!1}),M.method("pollForCheckCompletedStep",function(){var t=this.currentStep.completingConditions;if(t&&t.length>0&&!x.skippingStep){for(var e=!0,i=0;i<t.length;i++){var s=t[i];s()||(e=!1)}e&&(this.currentStep.autoContinue===!1?z.singleInstance.nextButton.enable():m.next())}}),M.method("prepareAndPlay",function(){if(m=this,this.isEligible())this.play();else{if(!this.preparation)throw new n("203","This wizard is not eligible neither has a preparation function.");this.preparation(function(){m.play()})}});var E=i.Class().extending(j).singleton;E.field("dimension",{}),E.field("position",{}),E.method("render",function(){this.$el=e("<div>").addClass("sideshow-details-panel").addClass("sideshow-hidden"),this.callSuper("render")}),E.method("positionate",function(){for(var t=N.CompositeMask.singleInstance.parts,e=[[t.top,"height"],[t.right,"width"],[t.bottom,"height"],[t.left,"width"]].sort(function(t,e){return t[0].dimension[t[1]]-e[0].dimension[e[1]]}),i=e.slice(-1)[0],s=2;s>0;s--){var n=e[s],o=n[0].dimension;o.width>250&&o.height>250&&o.width+o.height>2*(i[0].dimension.width+i[0].dimension.height)&&(i=n)}"width"==i[1]?this.$el.css("left",i[0].position.x).css("top",0).css("height",_.dimension.height).css("width",i[0].dimension.width):this.$el.css("left",0).css("top",i[0].position.y).css("height",i[0].dimension.height).css("width",_.dimension.width),this.dimension={width:r(this.$el.css("width")),height:r(this.$el.css("height"))},this.position={x:r(this.$el.css("left")),y:r(this.$el.css("top"))}});var P={};P.arrows=[],P.clear=function(){this.arrows=[]},P.setTargets=function(t,i){if(t.constructor===String&&(t=e(t)),t instanceof e&&t.length>0)t.each(function(){var t=B.build();t.target.$el=e(this),t.target.$el.is(":visible")&&(P.arrows.push(t),t.onceVisible=!0)});else if(!i)throw new n("150","Invalid targets.")},P.recreateDOMReferences=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.$el.remove()}P.clear(),P.setTargets(m.currentStep.targets,!0),P.render(),P.positionate(),P.show()},P.show=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.show()}},P.hide=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.hide()}},P.fadeIn=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.fadeIn()}},P.fadeOut=function(){function t(t){t.fadeOut(function(){t.destroy()})}for(var e=0;e<this.arrows.length;e++){var i=this.arrows[e];t(i)}},P.positionate=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.positionate()}},P.render=function(){for(var t=0;t<this.arrows.length;t++){var e=this.arrows[t];e.render()}},P.pollForArrowsChanges=function(){for(var t=!1,e=0;e<this.arrows.length;e++){var i=this.arrows[e];i.hasChanged()&&i.positionate(),i.onceVisible&&!i.target.$el.is(":visible")&&(t=!0)}t&&this.recreateDOMReferences()};var B=i.Class().extending(j);B.field("target",{}),B.field("onceVisible",!1),B.method("render",function(){this.$el=e("<div>").addClass("sideshow-subject-arrow").addClass("sideshow-hidden").addClass("sideshow-invisible"),this.callSuper("render")}),B.method("positionate",function(){var t=this.target;t.position={x:t.$el.offset().left-f.scrollLeft(),y:t.$el.offset().top-f.scrollTop()},t.dimension={width:t.$el.outerWidth(),height:t.$el.outerHeight()},this.$el.css("top",t.position.y-30+"px").css("left",t.position.x+r(t.dimension.width)/2-12+"px")}),B.method("show",function(){this.callSuper("show"),this.positionate()}),B.method("fadeIn",function(){this.callSuper("fadeIn"),this.positionate()}),B.method("hasChanged",function(){return this.target.dimension.width!==this.target.$el.outerWidth()||this.target.dimension.height!==this.target.$el.outerHeight()||this.target.position.y!==this.target.$el.offset().top-f.scrollTop()||this.target.position.x!==this.target.$el.offset().left-f.scrollLeft()});var z=i.Class(function(){this.nextButton=R.build()}).extending(j).singleton;z.field("text",""),z.field("title",""),z.field("dimension",{}),z.field("position",{}),z.field("nextButton"),z.method("setText",function(t){this.text=t,this.$el.find(".sideshow-step-text").text(t)}),z.method("setHTML",function(t){this.text=t,this.$el.find(".sideshow-step-text").html(t)}),z.method("setTitle",function(t){this.title=t,this.$el.find("h2:first").text(t)}),z.method("setStepPosition",function(t){this.stepPosition=t,this.$el.find(".sideshow-step-position").text(t)}),z.method("render",function(){this.$el=e("<div>").addClass("sideshow-step-description").addClass("sideshow-hidden").addClass("sideshow-invisible");var t=e("<span>").addClass("sideshow-step-position");this.$el.append(t),m.showStepPosition===!1&&t.hide(),this.$el.append(e("<h2>")),this.$el.append(e("<div>").addClass("sideshow-step-text")),this.nextButton.render(this.$el),this.nextButton.$el.click(function(){m.next()}),E.singleInstance.$el.append(this.$el)}),z.method("show",function(t){this.callSuper("show",t)}),z.method("positionate",function(){var t=E.singleInstance;this.dimension.width=t.dimension.width>=900?900:.9*t.dimension.width,this.$el.css("width",this.dimension.width);var e=(r(this.$el.css("padding-left"))+r(this.$el.css("padding-right")))/2,i=(r(this.$el.css("padding-top"))+r(this.$el.css("padding-bottom")))/2;this.dimension.height=r(this.$el.outerHeight()),this.dimension.height>t.dimension.height||this.dimension.width<400?(this.dimension.width=.9*f.width(),this.$el.css("width",this.dimension.width),this.dimension.height=r(this.$el.outerHeight()),this.position.x=(f.width()-this.dimension.width)/2,this.position.y=(f.height()-this.dimension.height)/2):(this.position.x=(t.dimension.width-this.dimension.width)/2,this.position.y=(t.dimension.height-this.dimension.height)/2),this.$el.css("left",this.position.x-e),this.$el.css("top",this.position.y-i)});var R=i.Class().extending($);R.field("_text"),R.method("disable",function(){this.$el.attr("disabled","disabled")}),R.method("enable",function(){this.$el.attr("disabled",null)}),R.method("setText",function(t){this._text=t,this.$el.text(t)}),R.method("render",function(t){this.$el=e("<button>").addClass("sideshow-next-step-button"),this.callSuper("render",t)});var _={};_.dimension={},_.hasChanged=function(){return f.width()!==this.dimension.width||f.height()!==this.dimension.height},_.updateInfo=function(){this.dimension.width=f.width(),this.dimension.height=f.height()};var W={};W.obj=null,W.dimension={},W.position={},W.borderRadius={},W.hasChanged=function(){return this.obj?this.obj.offset().left-f.scrollLeft()!==this.position.x||this.obj.offset().top-f.scrollTop()!==this.position.y||this.obj.outerWidth()!==this.dimension.width||this.obj.outerHeight()!==this.dimension.height||r(this.obj.css("border-top-left-radius"))!==this.borderRadius.leftTop||r(this.obj.css("border-top-right-radius"))!==this.borderRadius.rightTop||r(this.obj.css("border-bottom-left-radius"))!==this.borderRadius.leftBottom||r(this.obj.css("border-bottom-right-radius"))!==this.borderRadius.rightBottom||_.hasChanged():!1},W.updateInfo=function(t){void 0===t?(this.position.x=this.obj.offset().left-f.scrollLeft(),this.position.y=this.obj.offset().top-f.scrollTop(),this.dimension.width=this.obj.outerWidth(),this.dimension.height=this.obj.outerHeight(),this.borderRadius.leftTop=r(this.obj.css("border-top-left-radius")),this.borderRadius.rightTop=r(this.obj.css("border-top-right-radius")),this.borderRadius.leftBottom=r(this.obj.css("border-bottom-left-radius")),this.borderRadius.rightBottom=r(this.obj.css("border-bottom-right-radius"))):(this.position.x=t.position.x,this.position.y=t.position.y,this.dimension.width=t.dimension.width,this.dimension.height=t.dimension.height,this.borderRadius.leftTop=t.borderRadius.leftTop,this.borderRadius.rightTop=t.borderRadius.rightTop,this.borderRadius.leftBottom=t.borderRadius.leftBottom,this.borderRadius.rightBottom=t.borderRadius.rightBottom),_.updateInfo()},W.isSubjectVisible=function(t,e){return t.y+e.height>f.height()||t.y<0?!1:!0};var N={};N.SubjectMask=i.Class().extending(j).singleton,N.SubjectMask.method("render",function(){this.$el=e("<div>").addClass("sideshow-subject-mask"),this.callSuper("render")}),N.SubjectMask.method("update",function(t,e,i){this.$el.css("left",t.x).css("top",t.y).css("width",e.width).css("height",e.height).css("border-radius",i.leftTop+"px "+i.rightTop+"px "+i.leftBottom+"px "+i.rightBottom+"px ")}),N.CompositeMask=i.Class().extending(j).singleton,N.CompositeMask.method("init",function(){var t=this;["top","left","right","bottom"].forEach(function(e){t.parts[e]=N.CompositeMask.Part.build()}),["leftTop","rightTop","leftBottom","rightBottom"].forEach(function(e){t.parts[e]=N.CompositeMask.CornerPart.build()})}),N.CompositeMask.field("parts",{}),N.CompositeMask.method("render",function(){var t=this;for(var i in this.parts){var s=this.parts[i];s.render&&s.render()}this.$el=e(".sideshow-mask-part, .sideshow-mask-corner-part"),N.SubjectMask.singleInstance.render(),["leftTop","rightTop","leftBottom","rightBottom"].forEach(function(e){t.parts[e].$el.addClass(e)}),this.status=I.NOT_DISPLAYED}),N.CompositeMask.method("scrollIfNecessary",function(t,i){function s(t,i){e("body,html").animate({scrollTop:t},300,i)}if(!W.isSubjectVisible(t,i)){var n=z.singleInstance,o=i.height>f.height()-50?t.y:t.y-25;return o+=f.scrollTop(),s(o,function(){setTimeout(function(){E.singleInstance.positionate(),n.positionate(),n.fadeIn()},300)}),!0}return!1}),N.CompositeMask.method("update",function(t,e,i){N.SubjectMask.singleInstance.update(t,e,i);var s=t.x,n=t.y,o=e.width,r=e.height,a=i;this.parts.top.update({x:0,y:0},{width:f.width(),height:n}),this.parts.left.update({x:0,y:n},{width:s,height:r}),this.parts.right.update({x:s+o,y:n},{width:f.width()-(s+o),height:r}),this.parts.bottom.update({x:0,y:n+r},{width:f.width(),height:f.height()-(n+r)}),this.parts.leftTop.update({x:s,y:n},a.leftTop),this.parts.rightTop.update({x:s+o-a.rightTop,y:n},a.rightTop),this.parts.leftBottom.update({x:s,y:n+r-a.leftBottom},a.leftBottom),this.parts.rightBottom.update({x:s+o-a.rightBottom,y:n+r-a.rightBottom},a.rightBottom)}),N.CompositeMask.method("pollForSubjectChanges",function(){if(!x.lockMaskUpdate){if(m&&m.currentStep.subject){var t=e(m.currentStep.subject);W.obj[0]!==t[0]&&C.setSubject(t,!0)}W.hasChanged()&&(W.updateInfo(),this.update(W.position,W.dimension,W.borderRadius))}}),N.CompositeMask.method("pollForScreenChanges",function(){_.hasChanged()&&(_.updateInfo(),this.update(W.position,W.dimension,W.borderRadius))}),N.CompositeMask.Part=i.Class(function(t,e){this.position=t,this.dimension=e}).extending(T);var O=N.CompositeMask.Part;O.field("position",{}),O.field("dimension",{}),O.method("render",function(){this.$el=e("<div>").addClass("sideshow-mask-part").addClass("sideshow-hidden").addClass("sideshow-invisible"),this.callSuper("render")}),O.method("update",function(t,e){this.position=t,this.dimension=e,this.$el.css("left",t.x).css("top",t.y).css("width",e.width).css("height",e.height)}),N.CompositeMask.CornerPart=i.Class().extending(T);var D=N.CompositeMask.CornerPart;D.field("position",{}),D.field("dimension",{}),D.field("borderRadius",0),D.static.SVGPathPointsTemplate=function(t){return"m 0,0 0,"+t+" C 0,"+.46*t+" "+.46*t+",0 "+t+",0"},D.static.buildSVG=function(t){function i(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}var s=this.SVGPathPointsTemplate(t),n=e(i("svg")),o=e(i("path"));return o.attr("d",s),n.append(o),n[0]},D.prototype.render=function(){return this.$el=e("<div>").addClass("sideshow-mask-corner-part").addClass("sideshow-hidden").addClass("sideshow-invisible"),this.$el.append(D.buildSVG(this.borderRadius)),p.append(this.$el),this.$el},D.prototype.update=function(t,i){this.$el.css("left",t.x).css("top",t.y).css("width",i).css("height",i),e(this.$el).find("path").attr("d",D.SVGPathPointsTemplate(i))};var A={};A.queue=[],A.lock=!1,A.enqueue=function(){var t,e=arguments[0],i="";if("function"==typeof e?t=e:(i=arguments[0],t=arguments[1]),!(this.getFunctionIndex(t)<0&&(""===i||this.getFunctionIndex(i)<0)))throw new n("301","The function is already in the polling queue.");this.queue.push({name:i,fn:t,enabled:!0})},A.dequeue=function(){this.queue.splice(this.getFunctionIndex(arguments[0]),1)},A.enable=function(){this.queue[this.getFunctionIndex(arguments[0])].enabled=!0},A.disable=function(){this.queue[this.getFunctionIndex(arguments[0])].enabled=!1},A.getFunctionIndex=function(){var t=arguments[0];if("function"==typeof t)return this.queue.map(function(t){return t.fn}).indexOf(t);if("string"==typeof t)return this.queue.map(function(t){return t.name}).indexOf(t);throw new n("302","Invalid argument for getFunctionIndex method. Expected a string (the polling function name) or a function (the polling function itself).")},A.start=function(){this.lock=!1,this.doPolling()},A.stop=function(){this.lock=!0},A.clear=function(){var t=this.lock;this.lock=!0,this.queue=[],this.lock=t},A.doPolling=function(){this.lock||setTimeout(function(){for(var t=0;t<A.queue.length;t++){var e=A.queue[t];e.enabled&&e.fn()}A.doPolling()},b)};var V={};if(V.render=function(t){function i(t,e){t.click(function(){V.hide(function(){e.prepareAndPlay()})})}var s=e("<div>").addClass("sideshow-wizard-menu");this.$el=s;var n=e("<h1>").addClass("sideshow-wizard-menu-title");if(s.append(n),t.length>0){for(var o=e("<ul>"),r=0;r<t.length;r++){var h=t[r],d=e("<li>"),l=e("<h2>").text(h.title),u=h.description;u.length>100&&(u=u.substr(0,100)+"...");var c=e("<span>").addClass("sideshow-wizard-menu-item-description").text(u),f=e("<span>").addClass("sideshow-wizard-menu-item-estimated-time").text(h.estimatedTime);d.append(f,l,c),o.append(d),i(d,h)}s.append(o)}else e("<div>").addClass("sideshow-no-wizards-available").text(a(y.noAvailableWizards)).appendTo(s);p.append(s)},V.show=function(t,e){1==t.length&&C.config.autoSkipIntro?t[0].prepareAndPlay():(C.setEmptySubject(),N.CompositeMask.singleInstance.update(W.position,W.dimension,W.borderRadius),N.CompositeMask.singleInstance.fadeIn(),V.render(t),this.setTitle(e?e:a(y.availableWizards)))},V.hide=function(t){var e=this,i=e.$el;i&&i.addClass("sideshow-menu-closed"),setTimeout(function(){i&&i.hide(),t&&t()},v)},V.setTitle=function(t){this.$el.find(".sideshow-wizard-menu-title").text(t)},C.init=function(){f=e(t),g=e(t.document),p=e("body",t.document),u(),A.start(),N.CompositeMask.singleInstance.init(),x.lockMaskUpdate=!0,N.CompositeMask.singleInstance.render()},C.heredoc=function(t){return t.toString().match(/[^]*\/\*([^]*)\*\/\}$/)[1]},C.close=function(){m||V.hide(),E.singleInstance.fadeOut(),this.CloseButton.singleInstance.fadeOut(),P.fadeOut(),setTimeout(function(){(N.CompositeMask.singleInstance.status===I.VISIBLE||N.CompositeMask.singleInstance.status===I.FADING_IN)&&N.CompositeMask.singleInstance.fadeOut(),N.SubjectMask.singleInstance.fadeOut()},v),c(),A.clear(),C.ControlVariables.clear(),d(),m=null,x.running=!1},C.runWizard=function(t){var e=k.filter(function(e){return e.name===t})[0];if(m=e,!e)throw new n("204","There's no wizard with name "+t+".");if(e.isEligible())e.play();else{if(!e.preparation)throw new n("204","This wizard hasn't preparation.");e.preparation(function(){setTimeout(function(){e.play()},1e3)})}},C.gotoStep=function(){var t,e=arguments[0],i=m._storyline.steps;if(x.skippingStep=!0,"number"==typeof e){if(!(e<=i.length))throw new n("401","There's no step in the storyline with position "+e+".");t=i[e-1]}else if("string"==typeof e&&(t=i.filter(function(t){return t.name===e})[0],!t))throw new n("401","There's no step in the storyline with name "+e+".");setTimeout(function(){m.next(null,t)},100)},C.setEmptySubject=function(){x.lockMaskUpdate=!0,W.obj=null,W.updateInfo({dimension:{width:0,height:0},position:{x:0,y:0},borderRadius:{leftTop:0,rightTop:0,leftBottom:0,rightBottom:0}})},C.setSubject=function(t,i){if(t.constructor===String&&(t=e(t)),t instanceof e&&t.length>0){if(1!==t.length)throw new n("101","A subject must have only one element. Multiple elements by step will be supported in future versions of Sideshow.");W.obj=t,W.updateInfo(),x.lockMaskUpdate=!1}else{if(!i)throw new n("100","Invalid subject.");C.setEmptySubject()}},C.registerWizard=function(t){var e=M.build(t);return k.push(e),e},C.getElegibleWizards=function(t){for(var e=[],i=!1,s=0;s<k.length;s++){var n=k[s];n.isEligible()&&(n.isAlreadyWatched()||(i=!0),e.push(n))}return!t||i?e:[]},C.showWizardsList=function(){var t=arguments[0],e=arguments[1],i="boolean"==typeof t?!1:t,s=t instanceof Array?t:this.getElegibleWizards(i);return V.show(s,e),s.length>0},C.showRelatedWizardsList=function(t){var e=t.relatedWizards;if(!e)return!1;var i=k.filter(function(t){return e.indexOf(t.name)>-1&&(t.isEligible()||t.preparation)});return 0==i.length?!1:(A.clear(),C.ControlVariables.clear(),C.showWizardsList(i,a(y.relatedWizards)),!0)},C.CloseButton=i.Class().extending(j).singleton,C.CloseButton.method("render",function(){this.$el=e("<button>").addClass("sideshow-close-button").text(a(y.close)),this.$el.click(function(){C.close()}),this.callSuper("render")}),C.start=function(t){if(t=t||{},!x.running){var e="onlyNew"in t&&!!t.onlyNew,i="listAll"in t&&!!t.listAll;C.showWizardsList(i?k.filter(function(t){return t.isEligible()||t.preparation}):e),this.CloseButton.singleInstance.render(),this.CloseButton.singleInstance.fadeIn(),h(),x.running=!0,A.enqueue("check_composite_mask_screen_changes",function(){N.CompositeMask.singleInstance.pollForScreenChanges()})}},void 0!==t[w])throw new n("1",'The global access point "Sideshow" is already being used.');t[w]=C})}(this,jQuery,Jazz,Markdown);